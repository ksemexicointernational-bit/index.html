<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Flappy Fish KSE</title>
<style>
  body { margin:0; background:#0b3c5d; display:flex; justify-content:center; align-items:center; }
  canvas { background: linear-gradient(#0b5fa5, #012f4b); display:block; }
  .overlay {
    position:absolute; width:400px; height:400px; display:flex;
    flex-direction:column; justify-content:center; align-items:center;
    color:#fff; font-family:Arial, sans-serif; text-align:center;
  }
  button {
    margin-top:12px; padding:8px 14px; border:none; border-radius:8px;
    background:#00c2b8; color:#003333; font-weight:bold; cursor:pointer;
  }
</style>
</head>
<body>
<div style="position:relative; width:400px; height:400px;">
  <canvas id="game" width="400" height="400"></canvas>
  <div id="gameOver" class="overlay" style="display:none; background:rgba(0,0,0,.6);">
    <h2>Game Over</h2>
    <p>Puntaje: <span id="finalScore"></span></p>
    <button onclick="location.reload()">Reintentar</button>
  <button onclick="window.open('https://www.ksemexico.com.mx','_blank')">Conoce nuestro catálogo de peces y corales</button>
  </div>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let fish = { x: 80, y: 200, v: 0 };
let pipes = [];
let score = 0;
let gameOver = false;

function jump() {
  if (!gameOver) fish.v = -6;
}

canvas.addEventListener('click', jump);
document.addEventListener('keydown', e => {
  if (e.code === 'Space') jump();
});

function addPipe() {
  const gap = 140; // ajustado a 400x400
  const top = Math.random() * 140 + 40;
  pipes.push({ x: 400, top, bottom: top + gap, passed: false });
}

setInterval(() => {
  if (!gameOver) addPipe();
}, 1500);

function draw() {
  ctx.clearRect(0, 0, 400, 400);

  // Pez (forma de pez)
  ctx.save();
  ctx.translate(fish.x, fish.y);

  // cuerpo
  ctx.fillStyle = '#ffd166';
  ctx.beginPath();
  ctx.ellipse(0, 0, 14, 9, 0, 0, Math.PI * 2);
  ctx.fill();

  // cola
  ctx.fillStyle = '#f4a261';
  ctx.beginPath();
  ctx.moveTo(-14, 0);
  ctx.lineTo(-22, -6);
  ctx.lineTo(-22, 6);
  ctx.closePath();
  ctx.fill();

  // ojo
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.arc(6, -2, 2, 0, Math.PI * 2);
  ctx.fill();

  ctx.restore();

  // Corales
  ctx.fillStyle = '#ff6f61';
  pipes.forEach(p => {
    ctx.fillRect(p.x, 0, 36, p.top);
    ctx.fillRect(p.x, p.bottom, 36, 400 - p.bottom);
  });

  // Texto
  ctx.fillStyle = '#ffffff';
  ctx.font = '14px Arial';
  ctx.fillText('KSE MÉXICO', 10, 18);
  ctx.fillText('Puntaje: ' + score, 290, 18);
}

function update() {
  if (gameOver) return;

  fish.v += 0.35;
  fish.y += fish.v;

  pipes.forEach(p => {
    p.x -= 2.2;

    if (!p.passed && p.x + 36 < fish.x) {
      score++;
      p.passed = true;
    }

    if (
      fish.x > p.x &&
      fish.x < p.x + 36 &&
      (fish.y < p.top || fish.y > p.bottom)
    ) {
      endGame();
    }
  });

  pipes = pipes.filter(p => p.x > -40);

  if (fish.y > 400 || fish.y < 0) endGame();
}

function endGame() {
  gameOver = true;
  document.getElementById('finalScore').innerText = score;
  document.getElementById('gameOver').style.display = 'flex';
}

function loop() {
  draw();
  update();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
